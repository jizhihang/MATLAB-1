function fig = JPSTSettings(action)
global alignIDRange;
global spikeIDRange;
global startstopRange;
global startstopRange;
global ticksperms;
global binRange;
global scoop;
global DCvals;
global SCsm;        %scoop histogram smoothing value
global defaultCalculation;
global startTick;	%offset from align tick to start calculation
global stopTick;	%offset from align tick to stop calculation
global oldAlign;
global oldXID;
global oldYID;
global alignID;
global xID;
global yID;
global xList;


switch(action)
   
case('open')
cf = findobj('tag','JPSTSettings');
if ~isempty(cf)
   figure(cf);
   return;
end

% these need to be eliminated
ScoopInit = [-50 50];
DCInit = [-50 50];

xList = [];  % used to indicate whether anything has bee loaded yet


JPSTGUI('defaultDisplay');
load JPSTDefaultOptions
load JPSTDefaultSettings
defaultCalculation = 'calcNormalized';

xID = oldXID;
yID = oldYID;
alignID = oldAlign;

if binInitVal > length(binRange)	% if options are saved screwey
   binInitVal = 1;
end
JPST('setTimeRange',[startInitVal*ticksperms stopInitVal*ticksperms]);
JPST('setScoop',scoop);
JPST('setDC',DCvals);

h0 = figure('Units','points', ...
	'Color',[0.8 0.8 0.8], ...
	'Name','Settings', ...
	'NumberTitle','off', ...
   'MenuBar','none',...
   'CloseRequestFcn', '', ...
	'Position',[472.5 13.5 110.25 388.5], ...
	'Tag','JPSTSettings');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'ListboxTop',0, ...
   'Callback','JPSTGUI updateRaw',...
	'Position',[40.5 337.5 69 17.25], ...
	'String',' ', ...
	'Style','popupmenu', ...
	'Tag','xIDlist', ...
	'Value',1);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'ListboxTop',0, ...
   'Callback','JPSTGUI updateRaw',...
	'Position',[40.5 316.125 69 17.25], ...
	'String',' ', ...
	'Style','popupmenu', ...
	'Tag','yIDlist', ...
	'Value',1);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
   'ListboxTop',0, ...
   'Callback','JPSTGUI updateRaw',...
	'Position',[40.5 294 69 17.25], ...
	'String',' ', ...
	'Style','popupmenu', ...
	'Tag','alignIDlist', ...
   'Value',1);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 336.75 31.5 17.25], ...
	'String','x ID', ...
	'Style','text', ...
	'Tag','StaticText1');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 315 30.75 17.25], ...
	'String','y ID', ...
	'Style','text', ...
	'Tag','StaticText2');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 296.25 33.75 15.75], ...
	'String','align', ...
	'Style','text', ...
	'Tag','StaticText3');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 243.75 36 15.75], ...
	'String','start (ms)', ...
	'Style','text', ...
	'Tag','StaticText3');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 225.75 36 15.75], ...
	'String','stop (ms)', ...
	'Style','text', ...
   'Tag','StaticText4');

h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'ListboxTop',0, ...
	'Position',[66.75 207 42.75 15], ...
	'Callback','JPSTGUI setBinWidth', ...
	'String',' ', ...
	'Style','popupmenu', ...
	'Tag','binWidth', ...
	'Value',binInitVal);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3 204 59.25 16.5], ...
	'String','bin width (ms)', ...
	'Style','text', ...
	'Tag','StaticText5');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 294 33.75 15.75], ...
	'String','align', ...
	'Style','text', ...
	'Tag','StaticText3');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'FontSize',10, ...
	'ListboxTop',0, ...
	'Position',[3 358.5 105 14.25], ...
	'String','gdf ID information', ...
	'Style','text', ...
	'Tag','StaticText6');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'FontSize',10, ...
	'ListboxTop',0, ...
	'Position',[3 266.25 105 14.25], ...
	'String','timing information', ...
	'Style','text', ...
	'Tag','StaticText6');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'Callback','JPSTSettings save', ...
	'ListboxTop',0, ...
	'Position',[7.5 6.75 96 16.5], ...
	'String','save as defaults', ...
	'Tag','Pushbutton1', ...
	'TooltipString','save current settings values as defaults');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'Callback','JPSTGUI applySettings', ...
	'ListboxTop',0, ...
	'Position',[7.5 29.25 96 16.5], ...
   'String','show normalized', ...
   'Enable','off',...
	'Tag','dispWhat', ...
	'TooltipString','update display');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','JPSTGUI UpDateStop', ...
	'ListboxTop',0, ...
	'Max',startstopRange(2), ...
	'Min',startstopRange(1), ...
	'Position',[66.75 229.5 41.25 13.5], ...
   'SliderStep',[0.0010 0.0100],...
	'Style','slider', ...
	'Tag','StopSlider', ...
	'Value',stopInitVal);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','JPSTGUI UpDateStart', ...
	'ListboxTop',0, ...
	'Max',startstopRange(2), ...
	'Min',startstopRange(1), ...
   'Position',[66.75 245.25 41.25 14.25], ...
   'SliderStep',[0.0010 0.0100],...
	'Style','slider', ...
	'Tag','StartSlider', ...
	'Value',startInitVal);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','right', ...
	'ListboxTop',0, ...
	'Position',[40 245.25 25 12], ...
	'String',int2str(startInitVal), ...
	'Style','text', ...
	'Tag','starttextval');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','right', ...
	'ListboxTop',0, ...
	'Position',[40 229.5 25 12], ...
	'String',int2str(stopInitVal), ...
	'Style','text', ...
	'Tag','stoptextval', ...
	'Value',0);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'FontSize',10, ...
	'ListboxTop',0, ...
	'Position',[3 190 105 14.25], ...
	'String','scoop information', ...
	'Style','text', ...
	'Tag','StaticText6');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3 168 62.25 16.5], ...
	'String','smoothing (bins)', ...
	'Style','text', ...
   'Tag','StaticText5');
SCsm = 1;
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'Callback','JPSTGUI setScoopSmoothing', ...
	'ListboxTop',0, ...
	'Position',[66.75 172 42.75 15], ...
	'String',['0';'1';'2';'4'], ...
	'Style','popupmenu', ...
	'Tag','ScoopSmoothing', ...
	'Value',SCsm+1);
%h1 = uicontrol('Parent',h0, ...
%	'Units','points', ...
%	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
%	'FontSize',10, ...
%	'ListboxTop',0, ...
%	'Position',[3 174 105 14.25], ...
%	'String','scoop information', ...
%	'Style','text', ...
%	'Tag','StaticText6');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 150.75 40 15.75], ...
	'String','start (bins)', ...
	'Style','text', ...
	'Tag','StaticText3');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 132.75 40 15.75], ...
	'String','stop (bins)', ...
	'Style','text', ...
   'Tag','StaticText4');
quantum = 1/(ScoopInit(2)-ScoopInit(1));
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','JPSTGUI UpDateScoopStop', ...
	'ListboxTop',0, ...
	'Max',ScoopInit(2), ...
	'Min',ScoopInit(1), ...
	'Position',[66.75 137.25 41.25 13.5], ...
	'SliderStep',[quantum quantum*10], ...
	'Style','slider', ...
	'Tag','StopScoopSlider', ...
	'Value',scoop(2));
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','JPSTGUI UpDateScoopStart', ...
	'ListboxTop',0, ...
	'Max',ScoopInit(2), ...
	'Min',ScoopInit(1), ...
	'Position',[66.75 152.25 41.25 14.25], ...
	'SliderStep',[quantum quantum*10], ...
	'Style','slider', ...
	'Tag','StartScoopSlider', ...
	'Value',scoop(1));
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','right', ...
	'ListboxTop',0, ...
	'Position',[48 152.25 17 12], ...
	'String',int2str(scoop(1)), ...
	'Style','text', ...
	'Tag','Scoopstarttextval');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','right', ...
	'ListboxTop',0, ...
	'Position',[48 137.25 17 12], ...
	'String',int2str(scoop(2)), ...
	'Style','text', ...
	'Tag','Scoopstoptextval');
quantum = 1/(DCInit(2)-DCInit(1));
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','JPSTGUI UpDateDCStart', ...
	'ListboxTop',0, ...
	'Max',ScoopInit(2), ...
	'Min',ScoopInit(1), ...
	'Position',[66.75 93.75 41.25 14.25], ...
	'SliderStep',[quantum quantum*10], ...
	'Style','slider', ...
	'Tag','StartDCSlider', ...
	'Value',DCvals(1));
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','JPSTGUI UpDateDCStop', ...
	'ListboxTop',0, ...
	'Max',ScoopInit(2), ...
	'Min',ScoopInit(1), ...
	'Position',[66.75 78.75 41.25 13.5], ...
	'SliderStep',[quantum quantum*10], ...
	'Style','slider', ...
	'Tag','StopDCSlider', ...
	'Value',DCvals(2));
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 74.25 40 15.75], ...
	'String','stop (bins)', ...
	'Style','text', ...
	'Tag','StaticText4');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3.75 92.25 40 15.75], ...
	'String','start (bins)', ...
	'Style','text', ...
	'Tag','StaticText3');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'FontSize',10, ...
	'ListboxTop',0, ...
	'Position',[3 114.75 105 14.25], ...
	'String','delayed correlation', ...
	'Style','text', ...
	'Tag','StaticText6');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[3 58.5 62.25 16.5], ...
	'String','smoothing (bins)', ...
	'Style','text', ...
   'Tag','StaticText5');
dv = DCvals(3);
if dv < 4
   dv = dv+1;
end   
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'Callback','JPSTGUI setDCSmoothing', ...
	'ListboxTop',0, ...
	'Position',[66.75 61.5 42.75 15], ...
	'String',['0';'1';'2';'4'], ...
	'Style','popupmenu', ...
	'Tag','DCSmoothing', ...
	'Value',dv);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','right', ...
	'ListboxTop',0, ...
	'Position',[48 78.75 17 12], ...
	'String',int2str(DCvals(2)), ...
	'Style','text', ...
	'Tag','DCstoptextval');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','right', ...
	'ListboxTop',0, ...
	'Position',[48 93.75 17 12], ...
	'String',int2str(DCvals(1)), ...
	'Style','text', ...
	'Tag','DCstarttextval');

if nargout > 0, fig = h0; end

% set bw menu to default value
JPSTGUI('setBinMenuList',binInitVal);
JPSTGUI('setBinWidth');




case('save')
startInitVal = startTick/ticksperms;
stopInitVal = stopTick/ticksperms;
cf = findobj('tag','binWidth');
binInitVal =get(cf,'Value');

oldAlign = alignID;
oldXID = xID;
oldYID = yID;
   
save JPSTDefaultSettings.mat defaultCalculation startInitVal stopInitVal binInitVal scoop DCvals oldAlign oldXID oldYID
   
end	% main switch statement